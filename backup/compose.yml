# Example: Backup Sidecar Container (deploy once per host)
# This should be deployed separately from your application stacks

services:
  backup-sidecar:
    build:
      context: .
      dockerfile: Dockerfile
    restart: always
    # IMPORTANT: Copy .env.example to .env and fill in your actual credentials before deploying
    network_mode: host
    env_file:
      - .env
    # environment:
      # Cron schedule (default: 0 2 * * * = 2 AM daily)
      #- CRON_SCHEDULE=0 2 * * *
      
      # S3 Configuration (REQUIRED)
      # For AWS S3:
      # - S3_BUCKET_URL=s3://my-backup-bucket/backups
      # - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      # - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      # - AWS_DEFAULT_REGION=us-east-1
      
      # For MinIO or other S3-compatible storage:
      # - S3_BUCKET_URL=s3://my-backup-bucket/backups
      # - AWS_ACCESS_KEY_ID=minioadmin
      # - AWS_SECRET_ACCESS_KEY=minioadmin
      # - AWS_DEFAULT_REGION=us-east-1
      # - AWS_ENDPOINT_URL=https://minio.example.com
      
      # Optional: Limit compression threads (default: all cores)
      # - ZSTD_THREADS=4
    volumes:
      # REQUIRED: Access to Docker daemon
      - /var/run/docker.sock:/var/run/docker.sock
    # No network needed as we use `docker exec`
    # networks:
    #   - backup_net

# networks:
#   backup_net:
#     name: backup_default
#     driver: bridge
